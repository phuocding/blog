<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Orange Puzzle Game</title>
    <link href="../assets/img/brand/LogoOrange.min.jpg" rel="icon" type="image/jpg">
    <!-- Favicon -->
    <link href="../assets/img/brand/LogoOrange.min.jpg" rel="icon" type="image/jpg">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    <!-- Icons -->
    <link href="../assets/vendor/nucleo/css/nucleo.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
    <!-- Argon CSS -->
    <link type="text/css" href="../assets/css/argon.min.css?v=1.0.1" rel="stylesheet">
    <!--Sweet Alert 2-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@7.28.4/dist/sweetalert2.min.css">
    <style>
        @font-face {
        font-family: myFirstFont;
        src: url("../assets/font/SansForgetica-Regular.otf");
        }
    </style>
    <script src="https://d309knd7es5f10.cloudfront.net/createjs_1.1_min.js"></script>
    <script>
        var zon = true; // set to false to turn off console messages from zim
        var zns = false; // set to true to require zim namespace - eg. new zim.Frame()
    </script>
    <script src="https://d309knd7es5f10.cloudfront.net/zim_6.9.0.js"></script>
    <!-- use zimjs.com/distill for minified individual functions! -->

    <script>
        // SCALING OPTIONS
        // scaling can have values as follows with full being the default
        // "fit"	sets canvas and stage to dimensions and scales to fit inside window size
        // "outside"	sets canvas and stage to dimensions and scales to fit outside window size
        // "full"	sets stage to window size with no scaling
        // "tagID"	add canvas to HTML tag of ID - set to dimensions if provided - no scaling

        var scaling = "fit"; // this will resize to fit inside the screen dimensions
        var width = 1024;
        var height = 768;
        var countPieces = 0;
        var totalPieces = 0;
        // as of ZIM 5.5.0 you do not need to put zim before ZIM functions and classes
        var frame = new Frame(scaling, width, height);
        frame.on("ready", function () {
            // zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

            var stage = frame.stage;
            var stageW = frame.width;
            var stageH = frame.height;

            var puzzleX;
            var puzzleY;
            frame.outerColor = "#444";
            frame.color = "#ddd";

            var con = new Container

            // with chaining - can also assign to a variable for later access
            var imageObj = [];
            var piecesArrayObj = [];
            frame.loadAssets(["../assets/img/theme/lotus.jpeg"], "assets");

            var label = new Label({
                text: "CLICK",
                size: 60,
                font: "courier",
                color: "orange",
                rollColor: "red",
                fontOptions: "italic bold"
            });
            stage.addChild(label);
            label.x = label.y = 20;
            label.on("click", function () { zog("clicking"); });


            frame.on("complete", function () {


                imageObj = frame.asset("../assets/img/theme/lotus.jpeg").clone();
                imageObj.addTo(con);
                imageObj.alpha = 0.2;

                var piecesArray = new Array();
                var horizontalPieces = 5;
                var verticalPieces = 4;
                var obj = getQueryString();
                // zog(obj)
                if (obj) {
                    horizontalPieces = obj.row;
                    verticalPieces = obj.column;
                }
                var imageWidth = imageObj.width;
                var imageHeight = imageObj.height;
                var pieceWidth = Math.round(imageWidth / horizontalPieces);
                var pieceHeight = Math.round(imageHeight / verticalPieces);
                var gap = 40;
                totalPieces = horizontalPieces * verticalPieces;

                puzzleX = frame.width / 2 - imageWidth / 2;
                puzzleY = frame.height / 2 - imageHeight / 2;
                imageObj.pos(puzzleX, puzzleY);
                // zog(puzzleX,puzzleY);

                label.text = "Chúc mừng ngày ngày phụ nữ Việt Nam" + countPieces + "/" + totalPieces;


                for (j = 0; j < verticalPieces; j++) {
                    piecesArrayObj[j] = [];
                    for (i = 0; i < horizontalPieces; i++) {
                        var n = j + i * verticalPieces;

                        var offsetX = pieceWidth * i;
                        var offsetY = pieceHeight * j;


                        var x8 = Math.round(pieceWidth / 8);
                        var y8 = Math.round(pieceHeight / 8);

                        piecesArrayObj[j][i] = new Object();
                        piecesArrayObj[j][i].right = Math.floor(Math.random() * 2);
                        piecesArrayObj[j][i].down = Math.floor(Math.random() * 2);

                        if (j > 0) {
                            piecesArrayObj[j][i].up = 1 - piecesArrayObj[j - 1][i].down;
                        }
                        if (i > 0) {
                            piecesArrayObj[j][i].left = 1 - piecesArrayObj[j][i - 1].right;
                        }

                        piecesArray[n] = new Rectangle({
                            width: pieceWidth,
                            height: pieceHeight,

                        });



                        var tileObj = piecesArrayObj[j][i];
                        var s = new Shape

                        var context = s.graphics;
                        s.drag();
                        s.mouseChildren = false;
                        s.addEventListener("pressup", function (e) {
                            var mc = e.currentTarget;

                            var xx = Math.round(mc.x);
                            var yy = Math.round(mc.y);

                            if (xx < puzzleX + gap / 2 && xx > puzzleX - gap / 2 && yy < puzzleX + gap / 2 && yy > puzzleY - gap / 2) {
                                mc.x = puzzleX;
                                mc.y = puzzleY;
                                mc.noDrag();
                                mc.addTo(mc.parent, 0);
                                mc.mouseChildren = false;
                                mc.mouseEnabled = false;
                                mc.hint.visible = false;
                                countPieces++;
                                label.text = "Puzzle " + countPieces + "/" + totalPieces;
                                zog("countPieces", countPieces);
                                if (countPieces == totalPieces) {
                                    var pane = new Pane({ width: 600, label: "VERY NICE!", height: 250, modal: false, displayClose: false });

                                    var confirm = new Button(120, 50, "ON", "green").center(pane).mov(0, 70);

                                    confirm.on("click", function () {
                                        pane.hide();
                                        window.location.replace(window.location.pathname + window.location.search + window.location.hash);

                                    });
                                    pane.show();
                                }
                                stage.update();

                            }

                        });
                        context.setStrokeStyle(3, "round");
                        var commandi1 = context.beginStroke(createjs.Graphics.getRGB(0, 0, 0)).command;
                        //
                        var commandi = context.beginBitmapFill(imageObj.image).command;


                        context.moveTo(offsetX, offsetY);




                        if (j != 0) {
                            context.lineTo(offsetX + 3 * x8, offsetY);
                            if (tileObj.up == 1) {
                                context.curveTo(offsetX + 2 * x8, offsetY - 2 * y8, offsetX + 4 * x8, offsetY - 2 * y8);
                                context.curveTo(offsetX + 6 * x8, offsetY - 2 * y8, offsetX + 5 * x8, offsetY);
                            } else {
                                context.curveTo(offsetX + 2 * x8, offsetY + 2 * y8, offsetX + 4 * x8, offsetY + 2 * y8);
                                context.curveTo(offsetX + 6 * x8, offsetY + 2 * y8, offsetX + 5 * x8, offsetY);
                            }
                        }
                        context.lineTo(offsetX + 8 * x8, offsetY);
                        if (i != horizontalPieces - 1) {
                            context.lineTo(offsetX + 8 * x8, offsetY + 3 * y8);
                            if (tileObj.right == 1) {
                                context.curveTo(offsetX + 10 * x8, offsetY + 2 * y8, offsetX + 10 * x8, offsetY + 4 * y8);
                                context.curveTo(offsetX + 10 * x8, offsetY + 6 * y8, offsetX + 8 * x8, offsetY + 5 * y8);
                            } else {
                                context.curveTo(offsetX + 6 * x8, offsetY + 2 * y8, offsetX + 6 * x8, offsetY + 4 * y8);
                                context.curveTo(offsetX + 6 * x8, offsetY + 6 * y8, offsetX + 8 * x8, offsetY + 5 * y8);
                            }
                        }
                        context.lineTo(offsetX + 8 * x8, offsetY + 8 * y8);
                        if (j != verticalPieces - 1) {
                            context.lineTo(offsetX + 5 * x8, offsetY + 8 * y8);
                            if (tileObj.down == 1) {
                                context.curveTo(offsetX + 6 * x8, offsetY + 10 * y8, offsetX + 4 * x8, offsetY + 10 * y8);
                                context.curveTo(offsetX + 2 * x8, offsetY + 10 * y8, offsetX + 3 * x8, offsetY + 8 * y8);
                            } else {
                                context.curveTo(offsetX + 6 * x8, offsetY + 6 * y8, offsetX + 4 * x8, offsetY + 6 * y8);
                                context.curveTo(offsetX + 2 * x8, offsetY + 6 * y8, offsetX + 3 * x8, offsetY + 8 * y8);
                            }
                        }
                        context.lineTo(offsetX, offsetY + 8 * y8);
                        if (i != 0) {
                            context.lineTo(offsetX, offsetY + 5 * y8);
                            if (tileObj.left == 1) {
                                context.curveTo(offsetX - 2 * x8, offsetY + 6 * y8, offsetX - 2 * x8, offsetY + 4 * y8);
                                context.curveTo(offsetX - 2 * x8, offsetY + 2 * y8, offsetX, offsetY + 3 * y8);
                            } else {
                                context.curveTo(offsetX + 2 * x8, offsetY + 6 * y8, offsetX + 2 * x8, offsetY + 4 * y8);
                                context.curveTo(offsetX + 2 * x8, offsetY + 2 * y8, offsetX, offsetY + 3 * y8);
                            }
                        }
                        context.lineTo(offsetX, offsetY);
                        s.addTo(con);

                        var fill = new createjs.Graphics.Fill("red");

                        //var newGra = context.append(fill);
                        var hint = new Shape();//s.clone(true);
                        hint.mouseChildren = false;
                        hint.mouseEnabled = false;
                        s.hint = hint;
                        hint.graphics = context.clone(true);
                        hint.pos(puzzleX, puzzleY);
                        // newGra.graphics = newGra;
                        hint.graphics._fill = fill;
                        hint.graphics._fill.style = null;

                        hint.addTo(con, 0);
                        //s.animate({obj:{x:frame.width-offsetX-pieceWidth,y:frame.height-offsetY-pieceHeight}, time:700});
                        //s.animate({obj:{x:-offsetX,y:-offsetY}, time:700});
                        s.animate({ obj: { x: rand(-offsetX, frame.width - offsetX - pieceWidth), y: rand(-offsetY, frame.height - offsetY - pieceHeight) }, time: 700 });

                    }
                }


                con.addTo(stage);
                /*con.x -= imageWidth/2;
                con.y -= imageHeight/2;*/
                stage.update();



            }); // end asset complete


            stage.update(); // this is needed to show any changes

        }); // end of ready
    </script>

    <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>

<body>
    <header class="header-global">
        <nav id="navbar-main" class="navbar navbar-main navbar-expand-lg navbar-transparent navbar-light headroom">
            <div class="container">
                <a class="navbar-brand mr-lg-5" href="https://phuocding.github.io" style="font-family: myFirstFont">
                    <img src="../assets/img/brand/LogoOrange.min.jpg"> Ting Fu
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_global"
                    aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse" id="navbar_global">
                    <div class="navbar-collapse-header">
                        <div class="row">
                            <div class="col-6 collapse-brand">
                                <a href="https://phuocding.github.io">
                                    <img src="../assets/img/brand/LogoOrange.jpg"> Ting Fu
                                </a>
                            </div>
                            <div class="col-6 collapse-close">
                                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar_global"
                                    aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation">
                                    <span></span>
                                    <span></span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <ul class="navbar-nav navbar-nav-hover align-items-lg-center">
                        <li class="nav-item dropdown">
                            <a class="nav-link" href="./game.html" role="button">
                                <i class="ni ni-button-play"></i>
                                <span class="nav-link-inner--text">Thư giãn tý</span>
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link btn-dev" href="#" role="button">
                                <i class="ni ni-trophy"></i>
                                <span class="nav-link-inner--text">Xôi xéo</span>
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link btn-dev" href="#" role="button">
                                <i class="ni ni-user-run"></i>
                                <span class="nav-link-inner--text">Chim cút</span>
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link btn-dev" href="#" role="button">
                                <i class="ni ni-world"></i>
                                <span class="nav-link-inner--text">About me</span>
                            </a>
                        </li>
                    </ul>
                    <ul class="navbar-nav align-items-lg-center ml-lg-auto">
                        <li class="nav-item">
                            <a class="nav-link nav-link-icon" href="https://plus.google.com/107137651608531099184"
                                target="_blank" data-toggle="tooltip" title="Discover LinkedIn">
                                <i class="fab fa-linkedin"></i>
                                <span class="nav-link-inner--text d-lg-none">LinkedIn</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-icon" href="https://www.instagram.com/tingfu.om" target="_blank"
                                data-toggle="tooltip" title="Follow me on Instagram">
                                <i class="fab fa-instagram"></i>
                                <span class="nav-link-inner--text d-lg-none">Instagram</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-icon" href="https://github.com/phuocding/phuocding.github.io"
                                target="_blank" data-toggle="tooltip" title="Star me on Github">
                                <i class="fab fa-github"></i>
                                <span class="nav-link-inner--text d-lg-none">Github</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main class="profile-page" id="tagID">
        <!-- canvas with id="myCanvas" is made by zim Frame -->
    </main>
    <footer class="footer">
        <div class="container">
            <div class="row row-grid align-items-center mb-5">
                <div class="col-lg-6">
                    <h4 class="mb-0 font-weight-light" style="font-family: myFirstFont">The man who never made mistakes
                        never made anything.</h4>
                </div>
                <div class="col-lg-6 text-lg-center btn-wrapper">
                    <a target="_blank" href="https://plus.google.com/107137651608531099184" class="btn btn-neutral btn-icon-only btn-round btn-lg"
                        data-toggle="tooltip" data-original-title="Discover LinkedIn">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a class="btn btn-neutral btn-icon-only btn-instagram btn-round btn-lg" href="https://www.instagram.com/tingfu.om"
                        target="_blank" data-toggle="tooltip" title="Follow me on Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a target="_blank" href="https://github.com/phuocding/phuocding.github.io" class="btn btn-neutral btn-icon-only btn-github btn-round btn-lg"
                        data-toggle="tooltip" data-original-title="Star on Github">
                        <i class="fab fa-github"></i>
                    </a>
                </div>
            </div>
            <hr>
            <div class="row align-items-center justify-content-md-between">
                <div class="col-md-6">
                    <div class="copyright">
                        &copy; 2018
                        <a href="https://phuocding.github.io">Ting Fu</a>.
                    </div>
                </div>
                <div class="col-md-6">
                    <ul class="nav nav-footer justify-content-end">
                        <li class="nav-item">
                            <a href="./game.html" class="nav-link">Thư giãn tý</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link btn-dev">Xôi xéo</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link btn-dev">Chim cút</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link btn-dev">About me</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <!-- Core -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="assets/vendor/popper/popper.min.js"></script>
    <script src="assets/vendor/headroom/headroom.min.js"></script>
    <script src="assets/vendor/bootstrap/bootstrap.min.js"></script>
    <!-- Argon JS -->
    <script src="assets/js/argon.min.js"></script>
    <!--Sweet Alert 2-->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.28.4/dist/sweetalert2.all.min.js"></script>
    <script>
        $('.btn-dev').click(function () {
            swal({
                position: 'top-end',
                type: 'info',
                title: 'Tính năng đang phát triển',
                showConfirmButton: false,
                timer: 2000
            })
        });
    </script>
</body>

</html>
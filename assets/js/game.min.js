$(function(){function a(a,i){localStorage.setItem(a,i)}function t(a){return localStorage.getItem(a)}function n(i){a(i,parseInt(t(i))+1)}function e(i){a(i,parseInt(t(i))-1)}var s=function(a){if("-:-"==a)return a;var i=" "+a/1e3+" ";return i.substr(0,i.length-1)+"s"};function l(){$("#stats").html('<div class="padded"><h2>Figures: <span><b>'+t("flip_won")+"</b><i>Won</i><b>"+t("flip_lost")+"</b><i>Lost</i><b>"+t("flip_abandoned")+"</b><i>Abandoned</i></span></h2><ul><li><b>Best Casual:</b> <span>"+s(t("flip_casual"))+"</span></li><li><b>Best Medium:</b> <span>"+s(t("flip_medium"))+"</span></li><li><b>Best Hard:</b> <span>"+s(t("flip_hard"))+"</span></li></ul><ul><li><b>Total Flips:</b> <span>"+parseInt(2*(parseInt(t("flip_matched"))+parseInt(t("flip_wrong"))))+"</span></li><li><b>Matched Flips:</b> <span>"+t("flip_matched")+"</span></li><li><b>Wrong Flips:</b> <span>"+t("flip_wrong")+"</span></li></ul></div>")}function o(a){$("#g").removeAttr("class").empty(),$(".logo").fadeIn(250),$(".c1").text(a.substring(0,1)),$(".c2").text(a.substring(1,2)),$(".c3").text(a.substring(2,3)),$(".c4").text(a.substring(3,4)),"nice"==a?(n("flip_won"),e("flip_abandoned")):"fail"==a&&(n("flip_lost"),e("flip_abandoned")),l()}t("flip_won")||t("flip_lost")||t("flip_abandoned")||(a("flip_won",0),a("flip_lost",0),a("flip_abandoned",0),a("flip_casual","-:-"),a("flip_medium","-:-"),a("flip_hard","-:-"),a("flip_matched",0),a("flip_wrong",0)),(t("flip_won")>0||t("flip_lost")>0||t("flip_abandoned")>0)&&l(),$('.logo .card:not(".twist")').on("click",function(a){$(this).toggleClass("active").siblings().not(".twist").removeClass("active"),$(a.target).is(".playnow")&&$(".logo .card").last().addClass("active")}),$(".play").on("click",function(){n("flip_abandoned"),$(".info").fadeOut();var e="",s=1e3,l=$(this).data("level");8==l?(e="casual",s*=4*l):18==l?(e="medium",s*=5*l):32==l&&(e="hard",s*=6*l),$("#g").addClass(e),$(".logo").fadeOut(250,function(){var d=$.now(),p=[];for(i=0;i<l;i++)p.push(i);var r=function(a){for(var i,t,n=a.length;0!==n;)t=Math.floor(Math.random()*n),i=a[n-=1],a[n]=a[t],a[t]=i;return a}($.merge(p,p)),f=100/Math.sqrt(r.length);for(i=0;i<r.length;i++){var c=r[i];c<10&&(c="0"+c),30==c&&(c=10),31==c&&(c=21),$('<div class="card" style="width:'+f+"%;height:"+f+'%;"><div class="flipper"><div class="f"></div><div class="b" data-f="&#xf0'+c+';"></div></div></div>').appendTo("#g")}$("#g .card").on({mousedown:function(){if(1!=$("#g").attr("data-paused")){var i=$(this).addClass("active").find(".b").attr("data-f");$("#g").find(".card.active").length>1&&setTimeout(function(){var s=$("#g .active .b[data-f="+i+"]");if(s.length>1){if(s.parents(".card").toggleClass("active card found").empty(),n("flip_matched"),!$("#g .card").length){var l=$.now()-d;("-:-"==t("flip_"+e)||t("flip_"+e)>l)&&a("flip_"+e,l),o("nice")}}else $("#g .card.active").removeClass("active"),n("flip_wrong")},401)}}}),$('<i class="timer"></i>').prependTo("#g").css({animation:"timer "+s+"ms linear"}).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(a){o("fail")}),$(window).off().on("keyup",function(a){80==a.keyCode&&(1==$("#g").attr("data-paused")?($("#g").attr("data-paused","0"),$(".timer").css("animation-play-state","running"),$(".pause").remove()):($("#g").attr("data-paused","1"),$(".timer").css("animation-play-state","paused"),$('<div class="pause"></div>').appendTo("body"))),27==a.keyCode&&(o("flip"),1==$("#g").attr("data-paused")&&($("#g").attr("data-paused","0"),$(".pause").remove()),$(window).off())})})})});